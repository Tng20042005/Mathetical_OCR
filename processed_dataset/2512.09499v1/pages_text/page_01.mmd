Estimation of Stochastic Optimal Transport Maps

# Estimation of Stochastic Optimal Transport Maps

Sloan Nietert
  
EPFL
  
sloan.nietert@epfl.ch
  
&Ziv Goldfeld
  
Cornell University
  
goldfeld@cornell.edu

###### Abstract

The optimal transport (OT) map is a geometry-driven transformation between high-dimensional probability distributions which underpins a wide range of tasks in statistics, applied probability, and machine learning.
However, existing statistical theory for OT map estimation is quite restricted, hinging on Brenier’s theorem (quadratic cost, absolutely continuous source) to guarantee existence and uniqueness of a deterministic OT map, on which various additional regularity assumptions are imposed to obtain quantitative error bounds. In many real-world problems these conditions fail or cannot be certified, in which case optimal transportation is possible only via stochastic maps that can split mass.
To broaden the scope of map estimation theory to such settings, this work introduces a novel metric for evaluating the transportation quality of stochastic maps. Under this metric, we develop computationally efficient map estimators with near-optimal finite-sample risk bounds, subject to easy-to-verify minimal assumptions. Our analysis further accommodates common forms of adversarial sample contamination, yielding estimators with robust estimation guarantees. Empirical experiments are provided which validate our theory and demonstrate the utility of the proposed
framework in settings where
existing theory fails. These contributions constitute the first general-purpose theory for map estimation, compatible with a wide spectrum of real-world applications where optimal transport may be intrinsically stochastic.

\addauthor

snblue
\addauthorzgred
\CrefnamefactFactFacts
\CrefnameassumptionAssumptionAssumptions

## 1 Introduction

Optimal transport (OT) is a principled framework for comparing and transforming probability distributions according to the geometry of the underlying metric space (Villani, 2003; Santambrogio, 2015). Central to OT theory is the transport map, which performs said transformation. For \cX,\cY\subseteq\R^{d}, we say that T:\cX\to\cY is a *transport map* from source distribution \mu\in\cP(\cX) to target \nu\in\cP(\cY) if the pushforward measure T\_{\sharp}\mu=\mu\circ T^{-1} coincides with \nu. An optimal transport map T^{\star}, if it exists, is a solution to the *Monge OT problem* from \mu to \nu, which reads as follows for the p-Wasserstein cost:

|  |  |  |  |
| --- | --- | --- | --- |
|  | \inf\_{T:\,T\_{\sharp}\mu=\nu}\E\_{\mu}[\|X-T(X)\|^{p}]^{\frac{1}{p}}. |  | (1) |

Monge maps are employed for many applications, including domain adaptation (Courty et al., 2016; Redko et al., 2019), single-cell genomics (Schiebinger et al., 2019; Bunne et al., 2023), style transfer (Kolkin et al., 2019; Mroueh, 2020), and generative modeling (Zhang et al., 2018; Vesseron et al., 2025). An important special case is when p=2 and \mu is absolutely continuous with respect to (w.r.t.) the Lebesgue measure; then, Brenier’s theorem guarantees the existence of a unique Monge map, often called the *Brenier map*, given as the gradient of a convex potential (Brenier, 1991). More generally, existence of optimal maps is guaranteed if \mu is absolutely continuous and uniqueness holds if further p>1 (see, e.g., Section 2.4 of Villani, 2003).

There is a rich literature on formal guarantees for estimation of Brenier maps (Hütter and Rigollet, 2021; Pooladian and Niles-Weed, 2021; Deb et al., 2021; Manole et al., 2024) (see related work). However, all of these works impose stringent regularity assumptions on the density of \mu (e.g., two-sided bounds) and/or the unique Brenier map T^{\star} (e.g., Lipschitzness and Hölder smoothness). This is because the quality of the estimator is measured by its L^{p}(\mu) distance from T^{\star}, which inherently requires uniqueness (otherwise, the L^{p}(\mu) metric is meaningless) and hinges on said regularity assumptions to obtain quantitative error bounds. However, such regularity assumptions are often impossible to verify in practice. Worse yet, many real-world applications violate the conditions of Brenier’s theorem, whence deterministic Monge maps may not exist, and optimal transportation strategies require stochasticity. For instance, this is the case in domain adaptation whenever the source distribution lies on a lower-dimensional manifold than the target (Courty et al., 2016; Redko et al., 2019), such as in text-to-image or sketch-to-photo translation. Similarly, single-cell developmental trajectories branch over time, so any measure-preserving map from an early snapshot to a later one must be stochastic (Schiebinger et al., 2019). As such scenarios far exceed the account of current OT map estimation theory, this work sets out to close this gap by providing a broadly applicable estimation framework that offers strong recovery guarantees for a breadth of applications.

### 1.1 New Framework for Stochastic OT Map Estimation and Contributions

The Kantorovich OT problem (Kantorovich, 1942) relaxes that of Monge by allowing stochastic maps. Reparametrizing the standard formulation via couplings in terms of Markov kernels, it reads as

Figure 1: Previous map estimation theory only accounts for the inner circle, despite many OT map applications lying outside it. The proposed estimation framework under \cE\_{p} covers all possible \Wp problems (subject to tail bounds for quantitative rates).